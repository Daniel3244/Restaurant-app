services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DATASOURCE_URL: jdbc:h2:file:/app/data/h2/restaurantdb;DB_CLOSE_DELAY=-1
      SPRING_DATASOURCE_USERNAME: sa
      SPRING_DATASOURCE_PASSWORD: ""
      SPRING_DATASOURCE_DRIVER_CLASS_NAME: org.h2.Driver
      APP_CORS_ALLOWED_ORIGINS: http://localhost:8080
      APP_JWT_SECRET: dev-secret-key
      APP_UPLOAD_DIR: /app/uploads
    volumes:
      - ./backend/uploads:/app/uploads
      - backend_data:/app/data/h2

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        VITE_API_BASE_URL: http://localhost:8081
    ports:
      - "8080:80"
    depends_on:
      - backend

volumes:
  backend_data:
